---
title: "dtComb: An Extensive R Package for Combination of Diagnostic Tests"
author: 
- name: Serra İlayda YERLİTAŞ 
  affiliation: 
  - Erciyes University Faculty of Medicine Department of Biostatistics
  - Erciyes University Drug Application and Research Center (ERFARMA) 
- name: Serra Bersan GENGEÇ 
  affiliation: 
  - Erciyes University Drug Application and Research Center (ERFARMA) 
- name: Gözde ERTÜRK ZARARSIZ 
  affiliation: 
  - Erciyes University Faculty of Medicine Department of Biostatistics
  - Erciyes University Drug Application and Research Center (ERFARMA)   
- name: Selçuk KORKMAZ   
  affiliation: 
  - Trakya University Faculty of Medicine Department of Biostatistics
- name: Gökmen ZARARSIZ
  affiliation: 
  - Erciyes University Faculty of Medicine Department of Biostatistics
  - Erciyes University Drug Application and Research Center (ERFARMA)   
  email: gokmen.zararsiz@gmail.com  
  
package: dtComb

output:  
  BiocStyle::html_document:
    toc_float: true
 
vignette: >
  %\VignetteIndexEntry{dtComb: An Extensive R Package for Combination of Diagnostic Tests}
  %\VignetteEngine{knitr::rmarkdown}
    <!--
  %% \VignetteEngine{knitr::knitr}
  -->
  \usepackage[utf8]{inputenc}
---

```{r style, echo = FALSE, results = 'asis'}
  BiocStyle::markdown()
```

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = T, comment = "#>")
options(tibble.print_min = 4, tibble.print_max = 4)
```

<style>
.title.toc-ignore{
  font-size : 21pt !important
}
</style>
\begin{document}

# Implementation of dtComb package
The dtComb package combines two diagnostic tests and ıt was developed to bring  
together a large number of dispersed methods. Birleştirilecek olan iki tanı 
testi “data.frame”, altın  standart olarak kabul edilen test faktör sınıfında 
olmalıdır. Kullanacağımız ilk örnekte paket içerisinde yer alan exampleData1 
veri setini kullanacağız. Bu veri seti Erciyes Üniversitesi Tıp fakültesinde 
onaylı olarak alınmıştır. Öncelikle ilgili fonksiyonların kullanılabilmesi için 
dtComb kütüphanesinin yüklenmesi gerekmektedir.

```{r setup, message = FALSE}
devtools::load_all()
library(dtComb)
```

Benzer şekilde, aşağıdaki R kodu kullanılarak exampleData1 veri seti dtComb paketinden yüklenebilir:

```{r exampleData1, warning = FALSE}
# load exampleData1
data(exampleData1)
```
We used the data set from Akyıldız et al. [10] that contains data from patients admitted to the Erciyes University Medical Faculty’s General Surgery Department with the complaint of abdominal pain. Data include the leukocyte counts and D-dimer levels of 225 patients (115 females, 110 males) belonging to two groups. The first group had 115 (51.1%) patients who needed immediate laparotomy and the second group had 110 (49.9%) patients who did not need immediate laparotomy. Conventional treatment is assessed in this grouping and the patients operated on based on their postoperative pathologies are assigned to the first group, while the patients with a negative laparotomy are assigned to the second group [1].

**Example I** Eğitim verisi için bu verinin yalnızca 169 gözlemi içeren bir alt kümeyle çalışacağız. 169 gözlemli eğitim setinde laparotomi gereken 82(48.5) gözlem laparotomi gerektirmeyen 87(51.5) gözlem bulunmaktadır. Doğrusal kombinasyon metotları içerisinde yer alan Lojistik Regresyon tabanlı Skorlama [2], Todor & Saplacan’s method [8] yöntemlerini, doğrusal olmayan kombinasyon metotlarından Lasso Regression with Polynomial Feature Space ve Splines  kullanarak ddimer ve leukocyte tanı testlerini birleştireceğiz. 

```{r trainData, warning = FALSE}
# # train set of the exampleData1
trainData <- exampleData1[-c(83:138),]
head(trainData)

markers <- trainData[, -1]
status <- factor(trainData$group, levels = c("not_needed", "needed"))
```

## The `linComb` function
Bu bölümde doğrusal kombinasyon yöntemlerini içeren `linComb` fonksiyonunu tanıtacağız.Bu fonksiyon 8 farklı doğrusal kombinasyon metotları içerisinden kullanıcının seçtiği kombinasyon yöntemi ile yine kullanıcıya bırakılan resampling, standardization, cutoff, directions ve conf.levels yöntemlerini seçmek için tüm argümanları içermektedir. 

```{r linComb, message = FALSE, eval=FALSE}
linComb(markers = NULL,
        status = NULL,
        event = NULL,
        method = c("scoring",
                   "SL",
                   "logistic",
                   "minmax",
                   "PT",
                   "PCL",
                   "minimax",
                   "TS"),
        resample = c("none", "cv", "repeatedcv", "boot"),
        nfolds = 5,
        nrepeats = 3,
        niters = 10,
        standardize = c("none", "range",
                        "zScore", "tScore", "mean", "deviance"),
        ndigits = 0,
        direction = c("auto", "<", ">"),
        conf.level = 0.95,
        cutoff.method = c("youden", "roc01"))
```

The arguments and their definitions are given in Table 1.

: (\#tab:table1) Arguments of the `linComb` function.

Argument   | Definition
---- | ---------
`markers` | a numeric data frame that includes two diagnostic tests.
`status`  | vector that includes the actual disease status of the patients
`event` | string that indicates the event in the status to be considered as positive event
`method` | select one of the linear combination method. `scoring` for Scoring based on Logistic Regression [2], `SL` for Su & Liu's method [3], `logistic` for Logistic Regression, `minmax` for Min-Max method [5], `PT` for Pepe & Thompson's method [4], `PCL` for Pepe, Cai & Langton's method [6], `minimax` for Minimax approach [7] and `TS` for Todor & Saplacan’s method [8]. See details for further information.
`resample` | 	select one of the resampling option. `boot` for bootstrap, `cv` for Cross-validation, `repeatedcv` for Repeated Cross-validation.
`nfolds` | enter number of fold (5, default)
`nrepeats` |enter number of repeated (3, default)
`niters` | enter number of iters (10, default)
`standardize` | select one of the standardization option. `range` for standardization to a range between 0 and 1, `zScore` for standardization using z scores, `tScore` for standardization using T scores, `mean` for standardization with sample mean = 1, `deviance` for standardization with sample standard deviation = 1
`ndigits` | If scoring is selected as the combination method, enter to tell how many digits the estimated beta/regression coefficients should be rounded. (0, default)
`direction` | determines in which direction the comparison will be made.(auto, default)
`conf.level` | determines the confidens interval for the roc curve(0.95, default).
`cutoff.method` | determines the cutoff method for the roc curve.

### Scoring based on Logistic Regression method

`method = "scoring"` combination score obtained using the estimated beta/regression coefficients values of the relevant logistic regression model.

l = log_b p / (p - 1) = $\beta$_0 + $\beta$_1x_1 + $\beta$_2x_2

```{r scoring}
result <- linComb(markers = markers, 
                  status = status, 
                  event = "needed", 
                  method = "scoring", 
                  standardize = "range", 
                  ndigits = 2, direction = "auto", 
                  cutoff.method = "youden")
```

From the ROC curve that this function gives us as output, we can also evaluate the test results regarding the comparison of the combined diagnostic test with a higher AUC than the other two diagnostic tests, the single and combined diagnostic test statistics, the combined diagnostic test with the single diagnostic test scores.

###  Todor & Saplacan’s method 

`method = "TS"` combination score obtained by using the trigonometric functions of the Θ value that optimizes the corresponding AUC

*Combination Score*

```{r TS}
result <- linComb(markers = markers, 
                  status = status, 
                  event = "needed", 
                  method = "TS", 
                  resample = "cv", 
                  direction = "auto", 
                  cutoff.method = "youden")
```

## The `nonlinComb` function
Bu bölümde doğrusal olmayan kombinasyon yöntemlerini içeren `nonlinComb` fonksiyonunu tanıtacağız.Bu fonksiyon 7 farklı doğrusal olmayan kombinasyon metotları içerisinden kullanıcının seçtiği kombinasyon yöntemi ile kullanıcıya bırakılan polynomial based methods için degrees, splines için df'ler, polynomial based methods için oluşturulan feature space'e biyobelirteçler arasındaki etkileşimin dahil edilmesi veya edilmemesi seçeneği, resampling, standardization, cutoff, directions ve conf.levels yöntemlerini seçmek için tüm argümanları içermektedir.

```{r nonlinComb, message = FALSE, eval=FALSE}
nonlinComb(markers = NULL,
           status = NULL,
           event = NULL,
           method = c("polyreg",
                      "ridgereg",
                      "lassoreg",
                      "elasticreg",
                      "splines",
                      "sgam",
                       "nsgam"),
           degree1 = 3,
           degree2 = 3,
           df1 = 4,
           df2 = 4,
           resample = c("none", "cv", "repeatedcv", "boot"),
           nfolds = 5,
           nrepeats = 3,
           niters = 10,
           standardize = c("none", "range", "zScore", "tScore", 
                           "mean", "deviance"),
           include.interact = FALSE,
           alpha = 0.5,
           direction = c("auto" , "<", ">"),
           conf.level = 0.95,
           cutoff.method = c("youden", "roc01"))
```

The arguments and their definitions are given in Table 2.

: (\#tab:table2) Arguments of the `nonlinComb` function.

Argument   | Definition
---- | ---------
`markers` | a numeric data frame that includes two diagnostic tests.
`status`  | vector that includes the actual disease status of the patients
`event` | string that indicates the event in the status to be considered as positive event
`method` | select one of the linear combination method. `polyreg` for Logistic Regression with Polynomial Feature Space, `ridgereg` for Ridge Regression with Polynomial Feature Space [9], `lassoreg` for Lasso Regression with Polynomial Feature Space [9], `elasticreg` for Elastic Net Regression with Polynomial Feature Space [9], `splines` Splines [10], `sgam` for	Generalized Additive Models with Smoothing Splines [11], `nsgam` for Generalized Additive Models with Natural Cubic Splines [12].
`degree1` |
`degree2` |
`df1` |
`df2` |
`resample` | 	select one of the resampling option. `boot` for bootstrap, `cv` for Cross-validation, `repeatedcv` for Repeated Cross-validation.
`nfolds` | enter number of fold (5, default)
`nrepeats` |enter number of repeated (3, default)
`niters` | enter number of iters (10, default)
`standardize` | select one of the standardization option. `range` for standardization to a range between 0 and 1, `zScore` for standardization using z scores, `tScore` for standardization using T scores, `mean` for standardization with sample mean = 1, `deviance` for standardization with sample standard deviation = 1
`include.interact` |  (FALSE, default)
`alpha` |
`direction` | determines in which direction the comparison will be made.(auto, default)
`conf.level` | determines the confidens interval for the roc curve(0.95, default).
`cutoff.method` | determines the cutoff method for the roc curve.

### Lasso Regression with Polynomial Feature Space

`method = "lassoreg"` lasso regression is also a shrinkage method with one difference is that at the end this method returns the coefficients of some features as 0, makes this method useful for feature elimination as well.

```{r lassoreg}
result <- nonlinComb(markers = markers, 
                  status = status, 
                  event = "needed", 
                  method = "lassoreg", 
                  include.interact = "TRUE",
                  resample = "cv", 
                  direction = "auto", 
                  cutoff.method = "youden")
```

### Splines

`method = "splines"` with the applications of regression models in a polynomial feature space the second non-linear approach to combining biomarkers comes from applying several regression models to the dataset using a function derived from piecewise polynomials. Splines are implemented with degrees of freedom and degrees of the fitted polynomials taken from the user.

```{r splines}
result <- nonlinComb(markers = markers, 
                  status = status, 
                  event = "needed", 
                  method = "splines",
                  resample = "boot",
                  direction = "auto", 
                  cutoff.method = "youden")
```

**Example II** 

# Scoring

\begin{equation} \label{eqn:formula10}
  l = \log_b\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 x_1 + \beta_2 x_2
  \\
  Combination Score = \beta_1 x_1 + \beta_2 x_2
\end{equation}

# SL

\begin{equation} \label{eqn:formula11}
  Contol group = X \sim N(\mu_x , \sum)
  \\
  Disease \: group = Y \sim N(\mu_y ,\sigma ^ 2 \sum)
  \\
  Fisher's discriminant coefficient = (\alpha , \beta) \propto (\mu_y- \mu_x) ^ T {\sum_{}^{-1}} 
  \\<!--sigma üzerindeki -1 değişecek-->
  \\
 Combination Score = \alpha x_1 + \beta x_2
\end{equation}

# Logistic

\begin{equation} \label{eqn:formula12}
  l = \log_b\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 x_1 + \beta_2 x_2
\end{equation}

# Min-max

\begin{equation} \label{eqn:formula13}
  Control group: X_i = (X_1i, X_2i), i = 1, 2, ..., n
  \\
  Disease  group = Y_j = (Y_1j, Y_2j), j = 1, 2, ..., m
  \\ 
  maximize W(λ) = \left(\frac{1}{mn}\right) {\sum_{i=1}^{n} {\sum_{j=1}^{m}}I(Y_{j,max} + λY_{j,min} > X_{i,max} + λX_{i,min})}
  \\
   Combination Score = x_{max} + λx_{min}
\end{equation}

# PT

\begin{equation} \label{eqn:formula14}
  l = \log_b\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 x_1 + \beta_2 x_2
  \\ 
  λ = \beta_2/\beta_1
  \\
   Combination Score = x_1 + λx_2
\end{equation}

# PCL

\begin{equation} \label{eqn:formula15}
  Control group: X_i = (X_1i, X_2i), i = 1, 2, ..., n
  \\
  Disease  group = Y_j = (Y_1j, Y_2j), j = 1, 2, ..., m
  \\ 
  maximize W(λ) = \left(\frac{1}{mn}\right) {\sum_{i=1}^{n} {\sum_{j=1}^{m}}I(Y_{1j} + λY_{2j} > X_{1i} + λX_{2i}) + \left(\frac{1}{2} \right) I(Y_{1j} + λY_{2j} = X_{1i} + λX_{2i})}
  \\
   Combination Score = x_1 + λx_2
\end{equation}


# Minimax

\begin{equation} \label{eqn:formula16}
  Contol group: X_i =  (X_{1i}, X_{2i}), i = 1, 2, ... , n 
  \\
  Disease  group = Y_j =  (Y_{1j}, Y_{2j}), j = 1, 2, ... , m 
  \\
  (b_1, b_2) = {[t {\sum_{\;\;\;\;\;D}} + (1 - t) \sum_{C}] ^ {-1}}{(\mu_D - \mu_C)} 

  \\
 Combination Score = b_1 x_1 + b_2 x_2
\end{equation}

# TS

\begin{equation} \label{eqn:formula17}
   Combination \: Score = sin(\theta)x_1 + cos(\theta)x_2
\end{equation}

# References {.unlisted .unnumbered} 
[1]

[2]

[3] Su, J. Q., & Liu, J. S. (1993). Linear combinations of multiple diagnostic markers. Journal of the American Statistical Association, 88(424), 1350-1355.

[4] Pepe, M. S., & Thompson, M. L. (2000). Combining diagnostic test results to increase accuracy. Biostatistics, 1(2), 123-140.

[5] Liu, C., Liu, A., & Halabi, S. (2011). A min–max combination of biomarkers to improve diagnostic accuracy. Statistics in medicine, 30(16), 2005-2014.

[6] Pepe, M. S., Cai, T., & Longton, G. (2006). Combining predictors for classification using the area under the receiver operating characteristic curve. Biometrics, 62(1), 221-229.

[7] Sameera, G., Vardhan, R. V., & Sarma, K. V. S. (2016). Binary classification using multivariate receiver operating characteristic curve for continuous data. Journal of biopharmaceutical statistics, 26(3), 421-431.

[8] Todor, N., Todor, I., & Săplăcan, G. (2014). Tools to identify linear combination of prognostic factors which maximizes area under receiver operator curve. Journal of clinical bioinformatics, 4(1), 1-7.
\end{document}